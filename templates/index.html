<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <title>Ilia's Resume Chatbot</title>
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico" />
    <link href="/static/chatStyle.css" rel="stylesheet">
</head>
<body>
    <div id="chatbot_window">
        <nav id="navTitle">
            <h1>Ilia's Resume Chatbot</h1>
            <p id="prediction"></p>
            <!--
            <details id="prediction" style="display: none">
                <summary>Predictions</summary>
                <div></div>
            </details>
            -->
        </nav>
        <div id="chat_history"></div>
        <div id="input_window">
            <form id="messageForm" onsubmit="showChatbotResponse()" autocomplete="off">
                <textarea id="userInputBox" type="text" placeholder="Type your message here"></textarea>
                <div id="sendButton" type="button" onclick="showChatbotResponse()">
                    <img src="/static/images/send.png" alt="Send">
                </div>
            </form>
        </div>
    </div>
    <script type="text/javascript">
        fetch(`/get_response`, {
            method: "POST",
            body: JSON.stringify({msg: "hi"}),
            headers: {'Content-Type': 'application/json;'}
        }).then((response) => {console.log("Loaded API")}); // empty fetch in the background to wake up my heroku NLP API

        // Script for sending initial messages more naturally
        //   instead of them rendering with the page right away
        sendMsg (
            "Hi thereðŸ‘‹! I'm Ilia's Resume Chatbot, thanks for taking the time to chat with me!",
            2000
        ).then((nothing) => {
            sendMsg (
                "Ask me anything specific, or choose one of the options below and I can get the conversation rolling :)",
                1500
            )
        })

        async function sendMsg(msg, typingTime) {
            let chatHistoryDiv = document.getElementById("chat_history")

            let responseContainer = document.createElement("div")
            responseContainer.className = "responseContainer"
            let chatbotImg = document.createElement("img")
            chatbotImg.className = "chatbotImg"
            chatbotImg.src = "https://cdn.dribbble.com/users/37530/screenshots/2937858/drib_blink_bot.gif"
            responseContainer.appendChild(chatbotImg)

            let responseMsgDiv = document.createElement("div")
            responseMsgDiv.className = "chatbot_response"
            responseContainer.appendChild(responseMsgDiv)
            chatHistoryDiv.appendChild(responseContainer)

            let loadingGif = document.createElement("img")
            loadingGif.src = "/static/images/grey_circles-loading.gif"
            console.log(loadingGif.src)
            loadingGif.alt = "Loading..."
            loadingGif.className = "loadingGif"
            responseMsgDiv.appendChild(loadingGif)

            await sleep(typingTime)  // Let it load for a bit so it looks more natural

            let botMsg = document.createElement("p")
            botMsg.innerHTML = msg
            loadingGif.remove()
            responseMsgDiv.appendChild(botMsg)
        }

        function sleep(ms) {
          return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='chat.js') }}"></script>
</body>
</html>